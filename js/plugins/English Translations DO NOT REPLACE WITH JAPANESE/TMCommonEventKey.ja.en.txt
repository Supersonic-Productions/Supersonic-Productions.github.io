 // ================================================ =============================
// TMPlugin --Common event key
// Version: 1.0.2
// Last updated: 2017/06/28
// Distributor: http://hikimoki.sakura.ne.jp/
// ------------------------------------------------ -----------------------------
// Copyright (c) 2016 tomoaky
// Released under the MIT license.
// http://opensource.org/licenses/mit-license.php
// ================================================ =============================

/ *:
 * @plugindesc Set a common event for any key and in the map scene
 * Make it available as a shortcut key.
 *
 * @author tomoaky (http://hikimoki.sakura.ne.jp/)
 *
 * @ param commonKey0
 * @type number
 * @desc Common event number to start with 0 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey1
 * @type number
 * @desc Common event number to start with 1 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey2
 * @type number
 * @desc Common event number to start with 2 keys
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey3
 * @type number
 * @desc Common event number to start with 3 keys
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey4
 * @type number
 * @desc Common event number to start with 4 keys
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey5
 * @type number
 * @desc Common event number to start with 5 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey6
 * @type number
 * @desc Common event number to start with 6 keys
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey7
 * @type number
 * @desc Common event number to start with 7 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey8
 * @type number
 * @desc Common event number to start with 8 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKey9
 * @type number
 * @desc Common event number activated by 9 keys
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyA
 * @type number
 * @desc Common event number to start with A key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyB
 * @type number
 * @desc Common event number to start with B key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyC
 * @type number
 * @desc Common event number to start with C key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyD
 * @type number
 * @desc Common event number to start with D key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyE
 * @type number
 * @desc Common event number to start with E key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyF
 * @type number
 * @desc Common event number to start with F key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyG
 * @type number
 * @desc Common event number to start with G key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyH
 * @type number
 * @desc Common event number to start with H key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyI
 * @type number
 * @desc Common event number to start with I key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyJ
 * @type number
 * @desc Common event number to start with J key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyK
 * @type number
 * @desc Common event number to start with K key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyL
 * @type number
 * @desc Common event number to start with L key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyM
 * @type number
 * @desc Common event number to start with M key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyN
 * @type number
 * @desc Common event number to start with N key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyO
 * @type number
 * @desc Common event number to start with O key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyP
 * @type number
 * @desc Common event number to start with P key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyQ
 * @type number
 * @desc Common event number to start with Q key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyR
 * @type number
 * @desc Common event number to start with R key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyS
 * @type number
 * @desc Common event number to start with S key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyT
 * @type number
 * @desc Common event number to start with T key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyU
 * @type number
 * @desc Common event number to start with U key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyV
 * @type number
 * @desc Common event number to start with V key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyW
 * @type number
 * @desc Common event number to start with W key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyX
 * @type number
 * @desc Common event number to start with X key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyY
 * @type number
 * @desc Common event number to start with Y key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyZ
 * @type number
 * @desc Common event number to start with Z key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @param commonKeyF1
 * @type number
 * @desc Common event number activated by F1 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF2
 * @type number
 * @desc Common event number to start with F2 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF3
 * @type number
 * @desc Common event number to start with F3 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF4
 * @type number
 * @desc Common event number to start with F4 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF5
 * @type number
 * @desc Common event number to start with F5 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF6
 * @type number
 * @desc Common event number to start with F6 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF7
 * @type number
 * @desc Common event number to start with F7 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF8
 * @type number
 * @desc Common event number to start with F8 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF9
 * @type number
 * @desc Common event number to start with F9 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF10
 * @type number
 * @desc Common event number to start with F10 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF11
 * @type number
 * @desc Common event number to start with F11 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 *
 * @ param commonKeyF12
 * @type number
 * @desc Common event number to start with F12 key
 * Initial value: 0 (valid when 1 or more)
 * @default 0
 * 
 * @param freeMove
 * @type boolean
 * @desc The key is valid even while the player is moving.
 * Initial value: OFF (false = OFF disabled / true = ON enabled)
 * @default false
 *
 * @help
 * TMPlugin --Common event key ver1.0.2
 * 
 * How to use:
 *
 * Set the number of the common event you want to fire in the plugin parameter,
 * Press the corresponding key in the map scene to execute the common event.
 * 
 * The common event key is invalidated in the following situations.
 * ・ Scene switching
 * ・ Player is moving
 * ・ Event is running
 *
 * This plug-in has been confirmed to work with RPG Maker MV Version 1.5.0.
 *
 *
 * Caution:
 * 
 * If you use the standard function of RPG Maker MV or the key used in other plug-ins
 * Causes an error due to a conflict.
 * /

var Imported = Imported || {};
Imported.TMCommonEventKey = true;

(function () {

 var parameters = PluginManager.parameters ('TMCommonEventKey');
 var commonKeyCodes = {48: '0', 49: '1', 50: '2', 51: '3', 52: '4',
 53: '5', 54: '6', 55: '7', 56: '8', 57: '9',
 65:'A', 66:'B', 67:'C', 68:'D', 69:'E',
 70:'F', 71:'G', 72:'H', 73:'I', 74:'J',
 75:'K', 76:'L', 77:'M', 78:'N', 79:'O',
 80:'P', 81:'Q', 82:'R', 83:'S', 84:'T',
 85:'U', 86:'V', 87:'W', 88:'X', 89:'Y',
 90:'Z',
 112:'F1', 113:'F2', 114:'F3', 115:'F4',
 116:'F5', 117:'F6', 118:'F7', 119:'F8',
 120:'F9', 121:'F10', 122:'F11', 123:'F12'};
 var commonKeys = {};
 var keys = Object.keys (commonKeyCodes);
 for (var i = 0, len = keys.length; i <len; i ++) {
 var key = keys [i];
 var name ='commonKey' + commonKeyCodes [key];
 var commonEventId = + parameters [name];
 if (commonEventId> 0) {
 Input.keyMapper [key] = name;
 commonKeys [name] = commonEventId;
 }
 }
 var freeMove = JSON.parse (parameters ['freeMove']);

 // ------------------------------------------------ -----------------------------
 // Scene_Map
 // //
 
 var _Scene_Map_updateScene = Scene_Map.prototype.updateScene;
 Scene_Map.prototype.updateScene = function () {
 _Scene_Map_updateScene.call (this);
 if (! SceneManager.isSceneChanging () &&! $ GameMap.isEventRunning () &&
 (! $ GamePlayer.isMoving () || freeMove)) {
 Object.keys (commonKeys) .some (function (key) {
 if (Input.isTriggered (key)) {
 $ gameTemp.reserveCommonEvent (commonKeys [key]);
 return true;
 }
 });
 }
 };

}) ();
